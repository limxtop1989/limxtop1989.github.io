<!DOCTYPE html><html><head><meta charset="utf-8"><title>Java IO | 若批评不自由，则赞美无意义</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="# InputStream InputStream: 输入流的抽象，提供应用程从内存读取任意字节数（read 指针向后偏移），跳过，标记流位置（标记一个索引位置，reset 后，read 指针会重置为 mark 的值），流剩余字节数的 API。    FilterInputStream: 算是装饰者，包装或者聚合了 InputStream ，使用它作为基本的数据源。覆盖 InputStream"><meta property="og:type" content="article"><meta property="og:title" content="Java IO"><meta property="og:url" content="https://limxtop1989.github.io/limxtop1989.github.io/2022/09/10/Java-IO/index.html"><meta property="og:site_name" content="若批评不自由，则赞美无意义"><meta property="og:description" content="# InputStream InputStream: 输入流的抽象，提供应用程从内存读取任意字节数（read 指针向后偏移），跳过，标记流位置（标记一个索引位置，reset 后，read 指针会重置为 mark 的值），流剩余字节数的 API。    FilterInputStream: 算是装饰者，包装或者聚合了 InputStream ，使用它作为基本的数据源。覆盖 InputStream"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h61dub1vbaj20pq08o3z5.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h63mdvxjnlj20n30degng.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h61jgeoakgj20m207e3yy.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h63mf0qgkqj20la0dw3zx.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h63mgxpb3oj20nd0c875q.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h63mhs54j9j20in0gbq4c.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h63mlwea47j20oi09sq3m.jpg"><meta property="og:image" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h63mjpax45j206p05e3yk.jpg"><meta property="article:published_time" content="2022-09-10T02:18:36.000Z"><meta property="article:modified_time" content="2022-09-12T02:48:13.711Z"><meta property="article:author" content="文理兼修电脑首席"><meta property="article:tag" content="Java, IO, 源码"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://tva1.sinaimg.cn/large/e6c9d24egy1h61dub1vbaj20pq08o3z5.jpg"><link rel="alternate" href="/limxtop1989.github.io/atom.xml" title="若批评不自由，则赞美无意义" type="application/atom+xml"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/limxtop1989.github.io/css/style.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="container"><div id="wrap"><header id="header"><div id="banner"></div><div id="header-outer" class="outer"><div id="header-title" class="inner"><h1 id="logo-wrap"><a href="/limxtop1989.github.io/" id="logo">若批评不自由，则赞美无意义</a></h1></div><div id="header-inner" class="inner"><nav id="main-nav"><a id="main-nav-toggle" class="nav-icon"></a> <a class="main-nav-link" href="/limxtop1989.github.io/">Home</a> <a class="main-nav-link" href="/limxtop1989.github.io/archives">Archives</a></nav><nav id="sub-nav"><a id="nav-rss-link" class="nav-icon" href="/limxtop1989.github.io/atom.xml" title="RSS Feed"></a> <a id="nav-search-btn" class="nav-icon" title="Search"></a></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://limxtop1989.github.io/limxtop1989.github.io"></form></div></div></div></header><div class="outer"><section id="main"><article id="post-Java-IO" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/limxtop1989.github.io/2022/09/10/Java-IO/" class="article-date"><time datetime="2022-09-10T02:18:36.000Z" itemprop="datePublished">2022-09-10</time></a></div><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">Java IO</h1></header><div class="article-entry" itemprop="articleBody"><h1 id="inputstream"><a class="anchor" href="#inputstream">#</a> InputStream</h1><p>InputStream: 输入流的抽象，提供应用程从内存读取任意字节数（read 指针向后偏移），跳过，标记流位置（标记一个索引位置，reset 后，read 指针会重置为 mark 的值），流剩余字节数的 API。<br><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h61dub1vbaj20pq08o3z5.jpg" alt="data_structure"></p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h63mdvxjnlj20n30degng.jpg" alt="input_stream_class_diagram"></p><ol><li>FilterInputStream: 算是装饰者，包装或者聚合了 <code>InputStream</code> ，使用它作为基本的数据源。覆盖 <code>InputStream</code> 所有方法，简单的把方法调用转发给 <code>InputStream</code> 。</li></ol><figure class="highlight java"><figcaption data-lang="java"><span>a</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">InputStream</span> <span class="token keyword">implements</span> <span class="token class-name">Closeable</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">protected</span> <span class="token keyword">volatile</span> <span class="token class-name">InputStream</span> in<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="5"></td><td><pre>     * Creates a &lt;code>FilterInputStream&lt;/code></pre></td></tr><tr><td data-num="6"></td><td><pre>     * by assigning the  argument &lt;code>in&lt;/code></pre></td></tr><tr><td data-num="7"></td><td><pre>     * to the field &lt;code>this.in&lt;/code> so as</pre></td></tr><tr><td data-num="8"></td><td><pre>     * to remember it for later use.</pre></td></tr><tr><td data-num="9"></td><td><pre>     *</pre></td></tr><tr><td data-num="10"></td><td><pre>     * @param   in   the underlying input stream, or &lt;code>null&lt;/code> if</pre></td></tr><tr><td data-num="11"></td><td><pre>     *          this instance is to be created without an underlying stream.</pre></td></tr><tr><td data-num="12"></td><td><pre>     */</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token keyword">protected</span> <span class="token class-name">FilterInputStream</span><span class="token punctuation">(</span><span class="token class-name">InputStream</span> in<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>in <span class="token operator">=</span> in<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="2"><li>ByteArrayInputStream: 内部使用字节数组 <code>byte buf[]</code> 作为直接流数据源，每一次 read，都从 buf 读取数据。</li><li>BufferedInputStream: 内部也使用字节数组 <code>byte buf[]</code> ，不过它是代理的角色， 实际的数据流是类的聚合字段 <code>InputStream in</code> ，每一次 read 都是从 buf 读取数据，buf 数据读完，会从 <code>in</code> 预读取一块数据填充 <code>buf</code> 。<br>一般而言，当我们使用 File 作为数据源的时候，需要配合 <code>BufferedInputStream</code> 使用 <code>new BufferedInputStream(new BufferedInputStream())</code> ，一次读取文件系统的一大块数据（涉及磁盘旋转等耗时物理操作），然后应用程序可以一次一次读取小块数据，提高性能。</li><li>FileInputStream: 使用文件系统的文件作为流数据源，读取其原始的字节数据，如果要读取字符流，考虑使用 <code>FileReader</code></li></ol><blockquote><p>A FileInputStream obtains input bytes from a file in a file system. FileInputStream is meant for reading streams of raw bytes such as image data. For reading streams of characters, consider using FileReader.</p></blockquote><ol start="5"><li>ObjectInputStream: An ObjectInputStream deserializes primitive data and objects previously written using an ObjectOutputStream.</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObjectStreamDemo</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token class-name">FileOutputStream</span> fos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">"t.tmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token class-name">ObjectOutputStream</span> oos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectOutputStream</span><span class="token punctuation">(</span>fos<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  </pre></td></tr><tr><td data-num="5"></td><td><pre>        oos<span class="token punctuation">.</span><span class="token function">writeInt</span><span class="token punctuation">(</span><span class="token number">12345</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token string">"Today"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        oos<span class="token punctuation">.</span><span class="token function">writeObject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  </pre></td></tr><tr><td data-num="9"></td><td><pre>        oos<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        </pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"t.tmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token class-name">ObjectInputStream</span> ois <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>fis<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  </pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">int</span> i <span class="token operator">=</span> ois<span class="token punctuation">.</span><span class="token function">readInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token class-name">String</span> today <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Date</span><span class="token punctuation">)</span> ois<span class="token punctuation">.</span><span class="token function">readObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  </pre></td></tr><tr><td data-num="18"></td><td><pre>        ois<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="6"><li>SequenceInputStream: 代表多个 <code>InputStream</code> 的逻辑拼接 <code>Enumeration&lt;? extends InputStream&gt; e</code> 。程序开始时读取数组第一个 <code>InputStream</code> 元素，读完流数据，继续读第二个元素，如此反复。</li></ol><blockquote><p>A SequenceInputStream represents the logical concatenation of other input streams. It starts out with an ordered collection of input streams and reads from the first one until end of file is reached, whereupon it reads from the second one, and so on, until end of file is reached on the last of the contained input streams.</p></blockquote><ol start="7"><li>PushbackInputStream: 在 <code>read</code> 的基础上，支持 <code>unread</code> ，程序可以提前读取后续的字节，看看是什么数据，然后 <code>unread</code> 回到原来的状态，决定如何 <code>read</code> 。类似 <code>mark &amp; reset</code> ，不同之处是 unread 额外提供数据（可能是上一次 read 的，也可能是别的）， 覆盖 reset 区域。</li><li>PipedInputStream: 管道输入流必须和管道输出流连接，一般是一个线程从管道输入流读取数据，这些数据是另一个线程往管道输入流写入。单一线程使用管道输入输出流是不推荐的。PipedInputStream 构造时，传入管道输出流，并和它建立连接。</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PipedInputStream</span> <span class="token keyword">extends</span> <span class="token class-name">InputStream</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">PipedInputStream</span><span class="token punctuation">(</span><span class="token class-name">PipedOutputStream</span> src<span class="token punctuation">,</span> <span class="token keyword">int</span> pipeSize<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>            <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>         <span class="token function">initPipe</span><span class="token punctuation">(</span>pipeSize<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>         <span class="token function">connect</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    </pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">PipedOutputStream</span> src<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        src<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PipedOutputStream</span> <span class="token keyword">extends</span> <span class="token class-name">OutputStream</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token class-name">PipedInputStream</span> snk<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>snk <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>sink <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">||</span> snk<span class="token punctuation">.</span>connected<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Already connected"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        sink <span class="token operator">=</span> snk<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        snk<span class="token punctuation">.</span>in <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        snk<span class="token punctuation">.</span>out <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        snk<span class="token punctuation">.</span>connected <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>管道输出流写入数据时，向管道输入流发送接收的消息。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PipedOutputStream</span> <span class="token keyword">extends</span> <span class="token class-name">OutputStream</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">int</span> b<span class="token punctuation">)</span>  <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>sink <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Pipe not connected"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        sink<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>管道输入流接收管道输出流的数据，保存在 <code>buffer[in++]</code></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PipedInputStream</span> <span class="token keyword">extends</span> <span class="token class-name">InputStream</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">protected</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">receive</span><span class="token punctuation">(</span><span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token function">checkStateForReceive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        writeSide <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> out<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token function">awaitSpace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>in <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            in <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            out <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        buffer<span class="token punctuation">[</span>in<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>b <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>in <span class="token operator">>=</span> buffer<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            in <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    </pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="18"></td><td><pre>     * The index of the position in the circular buffer at which the</pre></td></tr><tr><td data-num="19"></td><td><pre>     * next byte of data will be stored when received from the connected</pre></td></tr><tr><td data-num="20"></td><td><pre>     * piped output stream. &lt;code>in&amp;lt;0&lt;/code> implies the buffer is empty,</pre></td></tr><tr><td data-num="21"></td><td><pre>     * &lt;code>in==out&lt;/code> implies the buffer is full</pre></td></tr><tr><td data-num="22"></td><td><pre>     * @since   JDK1.1</pre></td></tr><tr><td data-num="23"></td><td><pre>     */</pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token keyword">protected</span> <span class="token keyword">int</span> in <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="27"></td><td><pre>     * The index of the position in the circular buffer at which the next</pre></td></tr><tr><td data-num="28"></td><td><pre>     * byte of data will be read by this piped input stream.</pre></td></tr><tr><td data-num="29"></td><td><pre>     * @since   JDK1.1</pre></td></tr><tr><td data-num="30"></td><td><pre>     */</pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">protected</span> <span class="token keyword">int</span> out <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h61jgeoakgj20m207e3yy.jpg" alt=""><br>管道输入流维护写入，读出的下标索引，应用程序 <code>read</code> ，就从 buffer 读取数据 <code>int ret = buffer[out++] &amp; 0xFF;</code></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PipedInputStream</span> <span class="token keyword">extends</span> <span class="token class-name">InputStream</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>connected<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Pipe not connected"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>closedByReader<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Pipe closed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>writeSide <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>writeSide<span class="token punctuation">.</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                   <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>closedByWriter <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>in <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Write end dead"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>        readSide <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">int</span> trials <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">while</span> <span class="token punctuation">(</span>in <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>closedByWriter<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token comment">/* closed by writer, return EOF */</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>writeSide <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>writeSide<span class="token punctuation">.</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token operator">--</span>trials <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Pipe broken"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token comment">/* might be a writer waiting */</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>InterruptedIOException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token keyword">int</span> ret <span class="token operator">=</span> buffer<span class="token punctuation">[</span>out<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>out <span class="token operator">>=</span> buffer<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            out <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>in <span class="token operator">==</span> out<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>            <span class="token comment">/* now empty */</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            in <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token keyword">return</span> ret<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="9"><li>LineNumberInputStream: 读取字节如果是 A carriage-return character or a carriage return followed by a newline character 则 lineNumber 递增计数。应用程序可以通过 <code>java.io.LineNumberInputStream#getLineNumber</code> 获取行号记录。</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LineNumberInputStream</span> <span class="token keyword">extends</span> <span class="token class-name">FilterInputStream</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">int</span> c <span class="token operator">=</span> pushBack<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            pushBack <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            c <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">switch</span> <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>          <span class="token keyword">case</span> <span class="token char">'\r'</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            pushBack <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>pushBack <span class="token operator">==</span> <span class="token char">'\n'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                pushBack <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>          <span class="token keyword">case</span> <span class="token char">'\n'</span><span class="token operator">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            lineNumber<span class="token operator">++</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">return</span> <span class="token char">'\n'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">return</span> c<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="10"><li>DataInputStream: 和 ObjectInputStream 类似，区别在于它只支持读取基本数据类型。</li></ol><blockquote><p>A data input stream lets an application read primitive Java data types from an underlying input stream in a machine-independent way. An application uses a data output stream to write data that can later be read by a data input stream.</p></blockquote><ol start="11"><li>SocketInputStream: socket 通信时，系统分配一个 fd 给接收端，用于接收数据。应用程序通过系统读文件的系统调用，就可以读取 fd 的数据了。</li></ol><blockquote><p>This stream extends FileInputStream to implement a SocketInputStream. Note that this class should NOT be public.</p></blockquote><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">SocketInputStream</span> <span class="token keyword">extends</span> <span class="token class-name">FileInputStream</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token keyword">int</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">byte</span> b<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> off<span class="token punctuation">,</span> <span class="token keyword">int</span> length<span class="token punctuation">,</span> <span class="token keyword">int</span> timeout<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token keyword">int</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token comment">// EOF already encountered</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>eof<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token comment">// ignore</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token comment">// acquire file descriptor and do the read</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token class-name">FileDescriptor</span> fd <span class="token operator">=</span> impl<span class="token punctuation">.</span><span class="token function">acquireFD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            n <span class="token operator">=</span> <span class="token function">socketRead</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> b<span class="token punctuation">,</span> off<span class="token punctuation">,</span> length<span class="token punctuation">,</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token keyword">return</span> n<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ConnectionResetException</span> rstExc<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            gotReset <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            impl<span class="token punctuation">.</span><span class="token function">releaseFD</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token comment">// ignore</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        eof <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="13"><li>CheckedInputStream: 维护一个读取数据的校验和功能，可以验证输入数据的完整性。</li></ol><blockquote><p>An input stream that also maintains a checksum of the data being read. The checksum can then be used to verify the integrity of the input data.</p></blockquote><h1 id="outputstream"><a class="anchor" href="#outputstream">#</a> OutputStream</h1><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h63mf0qgkqj20la0dw3zx.jpg" alt="output_stream_class_diagram"><br>输出流总体上和输入流类似，只是方向相反。比如 <code>BufferedOutputStream</code> 有字节缓冲区 <code>byte buf[]</code> ，接收应用程序的写入，当缓冲区写满了，就调用装饰的输出流 <code>OutputStream out</code> 。 <code>PrintStream</code> 比较特殊，涉及到 <code>Writer</code> ，我们放到 <code>Writer</code> 部分展开。</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">BufferedOutputStream</span> <span class="token keyword">extends</span> <span class="token class-name">FilterOutputStream</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="3"></td><td><pre>     * Writes the specified byte to this buffered output stream.</pre></td></tr><tr><td data-num="4"></td><td><pre>     *</pre></td></tr><tr><td data-num="5"></td><td><pre>     * @param      b   the byte to be written.</pre></td></tr><tr><td data-num="6"></td><td><pre>     * @exception  IOException  if an I/O error occurs.</pre></td></tr><tr><td data-num="7"></td><td><pre>     */</pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">>=</span> buf<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token function">flushBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        buf<span class="token punctuation">[</span>count<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span>b<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="reader"><a class="anchor" href="#reader">#</a> Reader</h1><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h63mgxpb3oj20nd0c875q.jpg" alt="reader_class_diagram"><br>一次读取 <code>InputStream</code> 的两个字节，并使用指定的字符集解析成对应字符。Java 中一个 <code>char</code> 占用 2 <code>byte</code> ，但对于 UTF-8 字符集，它的编码长度是可变的，用 1`byte・来编码常见字符。</p><blockquote><p>A char represents a character in Java (*). It is 2 bytes large (or 16 bits).<br>That doesn't necessarily mean that every representation of a character is 2 bytes long. In fact many character encodings only reserve 1 byte for every character (or use 1 byte for the most common characters).</p></blockquote><ol><li>InputStreamReader: 作为字节流到字符流的桥接，读取一个或者多个字节，使用字符集解码成对应的字符。使用装饰者模式实现，解码工作由 <code>StreamDecoder</code> 完成。</li></ol><blockquote><p>An InputStreamReader is a bridge from byte streams to character streams: It reads bytes and decodes them into characters using a specified charset. The charset that it uses may be specified by name or may be given explicitly, or the platform's default charset may be accepted.<br>Each invocation of one of an InputStreamReader's read() methods may cause one or more bytes to be read from the underlying byte-input stream. To enable the efficient conversion of bytes to characters, more bytes may be read ahead from the underlying stream than are necessary to satisfy the current read operation.<br>For top efficiency, consider wrapping an InputStreamReader within a BufferedReader. For example:<br><code>BufferedReader in = new BufferedReader(new InputStreamReader(System.in));</code></p></blockquote><ol start="2"><li>FileReader: 实现很言简意赅和巧妙的令人叹为观止。提供 <code>FileInputStream</code> 给 <code>InputStreamReader</code> 作字节流数据源，就完事了，整个类才三个重载的构造器。</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileReader</span> <span class="token keyword">extends</span> <span class="token class-name">InputStreamReader</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>   <span class="token comment">/**</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    * Creates a new &lt;tt>FileReader&lt;/tt>, given the name of the</pre></td></tr><tr><td data-num="4"></td><td><pre>    * file to read from.</pre></td></tr><tr><td data-num="5"></td><td><pre>    *</pre></td></tr><tr><td data-num="6"></td><td><pre>    * @param fileName the name of the file to read from</pre></td></tr><tr><td data-num="7"></td><td><pre>    * @exception  FileNotFoundException  if the named file does not exist,</pre></td></tr><tr><td data-num="8"></td><td><pre>    *                   is a directory rather than a regular file,</pre></td></tr><tr><td data-num="9"></td><td><pre>    *                   or for some other reason cannot be opened for</pre></td></tr><tr><td data-num="10"></td><td><pre>    *                   reading.</pre></td></tr><tr><td data-num="11"></td><td><pre>    */</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">FileNotFoundException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="3"><li>BufferedReader: 也是使用装饰者模式。内部定义一个缓冲区，一次性读取源字符流一大块字符，以此对外提供字符流。</li><li>FilterReader: 同样是装饰者模式。里面啥也没做，所有的消息都转发给被装饰者，即内部的 <code>Reader</code> .</li><li>PushbackReader: 撤销读的实现很巧妙，使用 <code>char[] buf;</code> 并且索引 <code>pos</code> 初始为 size，unread 的字符写在这里，后续的读优先从这里读，里面如果没有数据，再从被装饰的 <code>Reader</code> 读。</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PushbackReader</span> <span class="token keyword">extends</span> <span class="token class-name">FilterReader</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">/** Pushback buffer */</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buf<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">/** Current position in buffer */</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">int</span> pos<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">/**</span></pre></td></tr><tr><td data-num="10"></td><td><pre>     * Creates a new pushback reader with a pushback buffer of the given size.</pre></td></tr><tr><td data-num="11"></td><td><pre>     *</pre></td></tr><tr><td data-num="12"></td><td><pre>     * @param   in   The reader from which characters will be read</pre></td></tr><tr><td data-num="13"></td><td><pre>     * @param   size The size of the pushback buffer</pre></td></tr><tr><td data-num="14"></td><td><pre>     * @exception IllegalArgumentException if &#123;@code size &lt;= 0&#125;</pre></td></tr><tr><td data-num="15"></td><td><pre>     */</pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">PushbackReader</span><span class="token punctuation">(</span><span class="token class-name">Reader</span> in<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">super</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>size <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"size &lt;= 0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>buf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">this</span><span class="token punctuation">.</span>pos <span class="token operator">=</span> size<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="6"><li>StringReader: 使用字符串作为字符流的数据源。</li><li>CharArrayReader: 使用字符数组作为字符流的数据源，里面的实现就全都是数组操作了。</li><li>PipedWriter: 与 <code>PipedInputStream</code> 类似，只是 API 接口参数从 <code>byte</code> 换成了 <code>char</code> 。</li><li>LineNumberReader: 增加字符流里的行号识别功能。</li></ol><h1 id="writer"><a class="anchor" href="#writer">#</a> Writer</h1><p>与 <code>Reader</code> 方向相反，和 <code>OutputStream</code> 类似，不再赘述。<br><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h63mhs54j9j20in0gbq4c.jpg" alt="write_class_diagram"></p><h1 id="randomaccessfile"><a class="anchor" href="#randomaccessfile">#</a> RandomAccessFile</h1><p>把文件当成一个 <code>byte[]</code> ，支持同时读写操作，读写指针做相应偏移。<br><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h63mlwea47j20oi09sq3m.jpg" alt=""></p><p><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h63mjpax45j206p05e3yk.jpg" alt="random_class_diagram"></p></div><footer class="article-footer"><a data-url="https://limxtop1989.github.io/limxtop1989.github.io/2022/09/10/Java-IO/" data-id="cl89icf83000c1k1361fg43qv" class="article-share-link">Share</a><ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/limxtop1989.github.io/tags/Java-IO-%E6%BA%90%E7%A0%81/" rel="tag">Java, IO, 源码</a></li></ul></footer></div><nav id="article-nav"><a href="/limxtop1989.github.io/2022/09/10/when-I-was-young/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Newer</strong><div class="article-nav-title">钱很重要么？</div></a><a href="/limxtop1989.github.io/2022/08/19/android-touch-event/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">Android Touch Event Dispatch</div></a></nav></article></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">Tags</h3><div class="widget"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/limxtop1989.github.io/tags/Android-Animation-Animator/" rel="tag">Android, Animation, Animator</a></li><li class="tag-list-item"><a class="tag-list-link" href="/limxtop1989.github.io/tags/Android-Touch-Event-Dispatch-%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%E6%B4%BE%E5%8F%91/" rel="tag">Android, Touch Event Dispatch, 触摸事件派发</a></li><li class="tag-list-item"><a class="tag-list-link" href="/limxtop1989.github.io/tags/Android-view-coordinate-canvas-coordinate-%E5%9D%90%E6%A0%87%E7%B3%BB/" rel="tag">Android, view coordinate, canvas coordinate, 坐标系</a></li><li class="tag-list-item"><a class="tag-list-link" href="/limxtop1989.github.io/tags/Java-IO-%E6%BA%90%E7%A0%81/" rel="tag">Java, IO, 源码</a></li><li class="tag-list-item"><a class="tag-list-link" href="/limxtop1989.github.io/tags/LifeCycle-LiveData/" rel="tag">LifeCycle, LiveData</a></li><li class="tag-list-item"><a class="tag-list-link" href="/limxtop1989.github.io/tags/ViewModel%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-Android-ViewModel/" rel="tag">ViewModel源码剖析, Android, ViewModel</a></li><li class="tag-list-item"><a class="tag-list-link" href="/limxtop1989.github.io/tags/%E8%8B%B1%E8%AF%AD-%E8%87%AA%E5%AD%A6-%E5%85%A5%E9%97%A8-%E6%8C%87%E5%8D%97-%E6%96%B9%E6%B3%95%E8%AE%BA-%E8%AF%8D%E5%85%B8/" rel="tag">英语,自学,入门,指南,方法论,词典</a></li><li class="tag-list-item"><a class="tag-list-link" href="/limxtop1989.github.io/tags/%E9%92%B1%EF%BC%8C%E5%B9%B4%E8%BD%BB/" rel="tag">钱，年轻</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">Tag Cloud</h3><div class="widget tagcloud"><a href="/limxtop1989.github.io/tags/Android-Animation-Animator/" style="font-size:10px">Android, Animation, Animator</a> <a href="/limxtop1989.github.io/tags/Android-Touch-Event-Dispatch-%E8%A7%A6%E6%91%B8%E4%BA%8B%E4%BB%B6%E6%B4%BE%E5%8F%91/" style="font-size:10px">Android, Touch Event Dispatch, 触摸事件派发</a> <a href="/limxtop1989.github.io/tags/Android-view-coordinate-canvas-coordinate-%E5%9D%90%E6%A0%87%E7%B3%BB/" style="font-size:10px">Android, view coordinate, canvas coordinate, 坐标系</a> <a href="/limxtop1989.github.io/tags/Java-IO-%E6%BA%90%E7%A0%81/" style="font-size:10px">Java, IO, 源码</a> <a href="/limxtop1989.github.io/tags/LifeCycle-LiveData/" style="font-size:10px">LifeCycle, LiveData</a> <a href="/limxtop1989.github.io/tags/ViewModel%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90-Android-ViewModel/" style="font-size:10px">ViewModel源码剖析, Android, ViewModel</a> <a href="/limxtop1989.github.io/tags/%E8%8B%B1%E8%AF%AD-%E8%87%AA%E5%AD%A6-%E5%85%A5%E9%97%A8-%E6%8C%87%E5%8D%97-%E6%96%B9%E6%B3%95%E8%AE%BA-%E8%AF%8D%E5%85%B8/" style="font-size:10px">英语,自学,入门,指南,方法论,词典</a> <a href="/limxtop1989.github.io/tags/%E9%92%B1%EF%BC%8C%E5%B9%B4%E8%BD%BB/" style="font-size:10px">钱，年轻</a></div></div><div class="widget-wrap"><h3 class="widget-title">Archives</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/limxtop1989.github.io/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/limxtop1989.github.io/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/limxtop1989.github.io/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/limxtop1989.github.io/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/limxtop1989.github.io/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/limxtop1989.github.io/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/limxtop1989.github.io/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/limxtop1989.github.io/archives/2021/07/">July 2021</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">Recent Posts</h3><div class="widget"><ul><li><a href="/limxtop1989.github.io/2022/09/10/when-I-was-young/">钱很重要么？</a></li><li><a href="/limxtop1989.github.io/2022/09/10/Java-IO/">Java IO</a></li><li><a href="/limxtop1989.github.io/2022/08/19/android-touch-event/">Android Touch Event Dispatch</a></li><li><a href="/limxtop1989.github.io/2022/07/24/Android-animation-principles/">Android 动画原理</a></li><li><a href="/limxtop1989.github.io/2022/02/24/Android-view-canvas-%E5%9D%90%E6%A0%87%E7%B3%BB/">Android view &amp; canvas 坐标系</a></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2022 文理兼修电脑首席<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></div></div></footer></div><nav id="mobile-nav"><a href="/limxtop1989.github.io/" class="mobile-nav-link">Home</a> <a href="/limxtop1989.github.io/archives" class="mobile-nav-link">Archives</a></nav><script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><link rel="stylesheet" href="/limxtop1989.github.io/fancybox/jquery.fancybox.css"><script src="/limxtop1989.github.io/fancybox/jquery.fancybox.pack.js"></script><script src="/limxtop1989.github.io/js/script.js"></script></div></body></html>